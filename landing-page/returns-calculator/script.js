const returnData = {
    veryCons: [
      -0.019887884, 0.09797217, 0.036536156, -0.039320524, 0.009338115,
      0.013675359, 0.036361159, 0.0817014, -0.021975481, -0.080296445,
      0.019292806, 0.012172488, 0.059189952, 0.021319021, 0.007369928,
      0.045760241, -0.023814469, -0.032536744, 0.033718177, -0.015406535,
      -0.008127267, 0.029219903, -0.004987432, -0.016825191, -0.018789159,
      0.02022969, -0.029767318, 0.026827882, 0.021913213, -0.011031121,
      0.013516298, 0.029340884, -0.015071054, 0.014621113, 0.020669214,
      -0.010376549, -0.003748103, 0.002584943, -0.00726754, 0.052968101,
      -0.00583523, 0.011816941, -0.00604833, -0.013431284, 0.008033682,
      0.009928304, -0.011789125, 0.023993542, 0.04698442, -0.00078353,
      -0.015296651, 0.015584056, -0.023275059, 0.009403211, -0.032231245,
      -0.030524123, 0.020651699, -0.020284545, -0.012355159, 0.012983694,
      -0.00122381, 0.005079091, -0.006891517, 0.018716413, -0.019704046,
      0.016303792, 0.026211457, 0.016739276, 0.023995438, 0.028721806,
      -0.001979791, 0.054134279, -0.027022105, 0.038459687, -0.025436618,
      0.005595788, -0.034326527, 0.01021666, 0.008732021, 0.010665558,
      -0.013337141, 0.019761962, 0.018702995, 0.034589447, 0.031382774,
      -0.020550285, -0.007741719, 0.003140933, 0.106185165, 0.00953987, 5.45e-3,
      0.010078531, 0.051357304, -0.042404844, 0.014146951, -0.010031308,
      0.020033883, -0.003257064, -0.02583181, 0.018700258, -0.008928859,
      -0.010419665, 0.030340428, -0.037208459, 0.012154651, -0.019036979,
      0.000116668, -0.047808547, 0.017294925, -0.017528485, 0.010870127,
      0.034294968, 0.006760552, 0.013430891, 0.013730512, -0.006123678,
      0.011311781, 0.001229069, 0.009902198, -0.013577637, -0.002508859,
      0.035814459, 0.002334867, 0.041673372, 0.010007609, 0.050623837,
      0.026183385, -0.015826527, -0.048286966, 0.002509699, -0.021361558,
      0.018749345, 0.039098031, -0.042735205, 0.015312679, 0.04673203,
      0.012067885, -0.035423177, -0.013268481, 0.035333284, 0.001932953,
      -0.017961305, -0.015236557, -0.002143408, -0.022649544, 0.006449213,
      0.004299981, -0.025940145, 0.031418908, -0.003247902, 0.011867117,
      0.018081493, -0.017122486, 0.028578124, -0.017954895, -0.007618977,
      -0.007002212, 0.005272404, 0.020851651, -0.004767243, 0.021707925,
      0.016297502, 0.043395266, 0.00307987, -0.044211598, -0.006893781,
      -0.008333095, 0.002012235, 0.004758442, -0.007480803, -0.009431061,
      0.008907433, -0.027996242, -0.009813855, 0.01232395, 0.019360922,
      -0.007160343,
    ],
  
    conservative: [
      -0.034915016, 0.089097298, 0.038232355, -0.024462979, -0.001657599,
      0.030677715, 0.038100084, 0.070707292, -0.022211798, -0.031773454,
      0.022606408, -0.00409333, 0.057071032, 0.030332418, 0.006630018,
      0.015682599, -0.03248642, -0.017204748, 0.020195116, 0.012566492,
      0.00311525, 0.0245439, 0.019695718, -0.016097645, -0.004881618, 0.01909807,
      -0.014678315, 0.014705046, 0.016051137, -0.014324249, -0.004740847,
      -0.001108366, 0.015583836, 0.014234569, 0.010771551, 0.007782513,
      0.006015343, 0.000430781, -0.011577631, 0.019749529, 0.00598805,
      0.014867232, 0.00017826, -0.004503954, 0.000375034, 0.011134758,
      -0.010619748, 0.037587056, 0.04012261, 0.004594788, -0.014838366,
      0.016494143, -0.030217882, 0.023021909, -0.029810225, -0.021839109,
      0.028269933, -0.015897306, -0.008368654, -0.001439136, 0.013125336,
      0.005220902, -0.002700399, 0.018074499, -0.009566521, 0.008966448,
      0.029368761, 0.005921872, 0.018916032, 0.029463875, -0.004473127,
      0.046208589, -0.014238034, 0.031051738, -0.020155547, 0.004386677,
      -0.041756817, 0.006540961, -0.006798601, 9.93e-5, 0.009625418, 0.016054715,
      0.012305038, 0.02009536, 0.033863256, -0.004970664, -0.005570921,
      0.003265878, 0.106213439, 0.020957709, 0.003768664, 0.013787622,
      0.043809507, -0.039161183, 0.018526826, -0.005029045, 0.028130198,
      -0.000921739, -0.023345248, 0.021586174, -0.0105498, -0.004292003,
      0.032051365, -0.03151793, 0.016962275, -0.014427837, 0.004394384,
      -0.033298981, 0.006377002, -0.020903191, 0.015668079, 0.038021568,
      0.0037054, 0.018577425, 0.015757115, -0.004109971, -0.008226017,
      0.004240721, -0.012303149, 0.002597948, 0.003986775, 0.035418916,
      0.006726903, 0.018001395, 0.03019081, 0.046774536, 0.014013938,
      -0.007190869, -0.040297119, 0.008699823, -0.008347348, 0.010216623,
      0.011197949, -0.051112444, 0.039446167, 0.053121012, 0.016926529,
      -0.021516436, 0.00602161, 0.024694273, -0.012301893, 0.007320456,
      -0.001084321, -0.002590878, -0.021692488, 0.015674978, 0.014242348,
      -0.019765494, 0.03405939, 0.002759915, 0.017892653, 0.004060729,
      0.000376884, 0.025624707, -0.00408709, -0.019989292, -0.009781872,
      0.019154573, 0.005699095, -0.005591686, -0.003872554, 0.032213594,
      0.028761468, -0.012908469, -0.021754169, 0.007185653, -0.022015166,
      0.015057706, -0.000130545, 0.007765975, -0.007328452, 0.01139294,
      -0.011338567, -0.00037946, 0.005691035, 0.011125264, -0.010790851,
    ],
  
    moderate: [
      -0.04038573, 0.084266865, 0.037953183, -0.017811883, -0.007153508,
      0.037668921, 0.03871175, 0.066298162, -0.022039185, -0.009642268,
      0.02318421, -0.010952056, 0.056477956, 0.033853609, 0.006831779,
      0.003811995, -0.035773751, -0.011671616, 0.015203893, 0.024423046,
      0.007942662, 0.02284234, 0.030118792, -0.016669671, 0.001414182, 0.01880129,
      -0.007694707, 0.009386518, 0.013463985, -0.014899325, -0.010940157,
      -0.014788953, 0.02851426, 0.014369867, 0.00534337, 0.01647231, 0.009646562,
      -0.000838196, -0.013502567, 0.005377845, 0.010933768, 0.016064406,
      0.003158974, -0.000381385, -0.003101035, 0.011585379, -0.010349249,
      0.043012247, 0.036701325, 0.006774594, -0.015593403, 0.016180464,
      -0.034118424, 0.029263957, -0.028085304, -0.018926592, 0.03122154,
      -0.014824498, -0.007234983, -0.007105833, 0.019468491, 0.004969841,
      -0.001019406, 0.017340685, -0.004806755, 0.005548217, 0.030593724,
      0.000813567, 0.016357241, 0.029568915, -0.00536853, 0.043719149,
      -0.009563808, 0.027746859, -0.017978402, 0.003834413, -0.044880967,
      0.00413277, -0.012671472, -0.004396361, 0.019098322, 0.01375389,
      0.009675664, 0.014761614, 0.036054322, 0.001296783, -0.004242754,
      0.002589917, 0.107101079, 0.025862295, 0.002737764, 0.015428369,
      0.040463664, -0.038593982, 0.020105822, -0.002461108, 0.031679803, -1.72e-5,
      -0.022176052, 0.022318912, -0.011409249, -0.001391569, 0.033061802,
      -0.029552911, 0.01868946, -0.012479526, 0.006800705, -0.027351624,
      0.001925922, -0.022588938, 0.018285427, 0.039232197, 0.002074409,
      0.020216767, 0.015750915, -0.002872329, -0.016112402, 0.005426478,
      -0.020623771, 0.009150024, 0.006481305, 0.034639137, 0.007954832,
      0.008881813, 0.038835743, 0.045150827, 0.008615668, -0.003790268,
      -0.037077678, 0.010955943, -0.002786908, 0.007019111, -0.001029499,
      -0.053080599, 0.048911369, 0.055038207, 0.018892475, -0.01513453,
      0.013653039, 0.01989803, -0.018350469, 0.017027877, 0.005535159,
      -0.002669416, -0.02175185, 0.019415676, 0.018297376, -0.01608401,
      0.033670818, 0.005437688, 0.019891963, -0.001015773, 0.006896736,
      0.024770688, 0.00166315, -0.024442875, -0.009122524, 0.025564983, 4.95e-5,
      -0.00627778, -0.014488139, 0.037429109, 0.023278401, -0.018614247,
      -0.012677178, 0.012379237, -0.026644339, 0.021135262, -0.002702019,
      0.014423872, -0.006604266, 0.011789413, -0.004588818, 0.00374847,
      0.002789747, 0.008062081, -0.011615798,
    ],
    modAgg: [
      -0.046838854, 0.079925225, 0.038365414, -0.010912388, -0.011998389,
      0.045077058, 0.039342122, 0.061390344, -0.021913337, 0.011921556,
      0.024276397, -0.018040338, 0.055365541, 0.03764248, 0.006560174,
      -0.009349158, -0.039384922, -0.004931412, 0.009359127, 0.036783735,
      0.012981112, 0.020626703, 0.0408809, -0.016346557, 0.007672481, 0.018161828,
      -0.000688876, 0.00399561, 0.010741548, -0.016033518, -0.018552783,
      -0.028290967, 0.042010337, 0.014164404, 0.000789402, 0.024588249,
      0.013877032, -0.001733991, -0.015332438, -0.009383541, 0.01621483,
      0.017414776, 0.006064984, 0.003679443, -0.006522673, 0.012068352,
      -0.009880364, 0.048816176, 0.033406167, 0.009162108, -0.01541156,
      0.016367625, -0.037328055, 0.035360422, -0.026751968, -0.015156488,
      0.034454277, -0.012875232, -0.005500562, -0.013248691, 0.025945771,
      0.004839712, 0.00087474, 0.016898342, -0.000230045, 0.002203501,
      0.031850418, -0.004024927, 0.014038177, 0.029940102, -0.006392475,
      0.040510252, -0.00414931, 0.024484565, -0.015754439, 0.003381998,
      -0.048109171, 0.002561124, -0.019275819, -0.00898135, 0.029196346,
      0.011990539, 0.006945634, 0.008672293, 0.03726175, 0.007929575,
      -0.003213239, 0.002571683, 0.107184693, 0.030858614, 0.00194797, 0.01701818,
      0.037141372, -0.037391031, 0.021995207, -0.00021776, 0.035299536,
      0.000987895, -0.021023904, 0.023123568, -0.012173564, 0.00151431,
      0.033729554, -0.027227619, 0.020558049, -0.010325577, 0.009169765,
      -0.021422627, -0.002682529, -0.024639583, 0.021313564, 0.040838056,
      0.0008326, 0.022244049, 0.015983019, -0.001312618, -0.024644575,
      0.006576362, -0.02983377, 0.015724141, 0.009408216, 0.034182704,
      0.009302919, -0.000611809, 0.047319572, 0.043670959, 0.002310235, 2.02e-6,
      -0.033991746, 0.013770611, 0.002702801, 0.003562604, -0.014149381,
      -0.055363074, 0.058608695, 0.057090196, 0.020716085, -0.009383143,
      0.021970541, 0.015034354, -0.02474516, 0.027979565, 0.011963758, -2.53e-3,
      -0.021195093, 0.023610232, 0.022362563, -0.01269271, 0.033931492,
      0.008145265, 0.022122744, -0.006107039, 0.013877392, 0.024178685,
      0.007433955, -0.029240951, -0.008782903, 0.032450059, -0.006057902,
      -0.00676186, -0.025612181, 0.043340821, 0.017743765, -0.024557268,
      -0.002981964, 0.017132963, -0.031746982, 0.027353489, -0.004987191,
      0.021008183, -0.005844943, 0.012412895, 0.002864053, 0.00789375, 2.3e-5,
      0.005122482, -0.013272336,
    ],
    aggressive: [
      -0.060728357, 0.079628013, 0.044834158, -0.00224985, -0.015936516,
      0.05769314, 0.041343769, 0.053286701, -0.023577053, 0.036968423,
      0.030550853, -0.029267286, 0.052483354, 0.045353813, 0.003628662,
      -0.03366606, -0.046681255, 0.009731995, -0.00298974, 0.055415866,
      0.020054958, 0.015994468, 0.057772335, -0.012081502, 0.014801207,
      0.016864722, 0.006488189, -0.003360497, 0.007390139, -0.022125384,
      -0.038279838, -0.045540546, 0.062842991, 0.012318878, -0.000440127,
      0.032419834, 0.022804693, -0.001986152, -0.018009786, -0.030597195,
      0.024466779, 0.019763328, 0.008580147, 0.008158331, -0.010369009,
      0.013290445, -0.007682557, 0.059291726, 0.031103172, 0.012785074,
      -0.010832983, 0.020026217, -0.037837127, 0.042209123, -0.028417522,
      -0.00561306, 0.040871384, -0.006769252, -0.000560186, -0.025239074,
      0.034186058, 0.006563875, 0.004019053, 0.0186681, 0.004240013, -0.001274205,
      0.034429301, -0.009093397, 0.012343833, 0.031233637, -0.009256767,
      0.031238065, 0.007951022, 0.020207938, -0.011440271, 0.002385934,
      -0.053262512, 0.003699841, -0.033117375, -0.016068579, 0.045389994,
      0.012688947, 0.002264377, -0.0049196, 0.033741765, 0.020183672,
      -0.003616987, 0.005647167, 0.103144946, 0.038358899, 0.002297133,
      0.019345691, 0.032762773, -0.031897202, 0.026293906, 0.001297744,
      0.039914621, 0.00322658, -0.019668209, 0.025707008, -0.012181756,
      0.005235448, 0.033115195, -0.021529919, 0.024503872, -0.006960388,
      0.011499851, -0.012618977, -0.010296064, -0.027764792, 0.025593046,
      0.044297757, 0.00058101, 0.027581637, 0.018124201, 0.00105781, -0.040678797,
      0.008368633, -0.048131163, 0.026546088, 0.015186367, 0.035555137,
      0.012659287, -0.017988303, 0.058660387, 0.04117776, -0.010079268,
      0.007870902, -0.029670845, 0.020346816, 0.010476344, -0.004399101,
      -0.03487423, -0.064802823, 0.074501413, 0.061810074, 0.023566512,
      -0.003760068, 0.036741482, 0.009140776, -0.034717121, 0.050347409,
      0.019641309, -0.001476878, -0.016908214, 0.031172647, 0.02791459,
      -0.011328456, 0.039330267, 0.011079936, 0.02692179, -0.014865716,
      0.026136178, 0.022398221, 0.016428254, -0.038084577, -0.01341753,
      0.041431891, -0.01708202, -0.005605902, -0.044420812, 0.056646805,
      0.008729155, -0.036333903, 0.014021626, 0.02477291, -0.043074133,
      0.035378274, -0.006513689, 0.028601436, -0.004213298, 0.014245426,
      0.01662062, 0.013555608, -0.004162418, 0.001064955, -0.020636873,
    ],
    veryAgg: [
      -0.076547888, 0.08427318, 0.055147375, 0.00397661, -0.016138817,
      0.069842456, 0.043911899, 0.045359149, -0.026404082, 0.052076157,
      0.039731635, -0.039368185, 0.048636858, 0.05356737, -0.001202742,
      -0.058800842, -0.05454926, 0.02665167, -0.016860576, 0.071669056,
      0.02587599, 0.010556221, 0.07285789, -0.004774571, 0.019166614, 0.015098411,
      0.010154022, -0.009114072, 0.004964536, -0.031089112, -0.062418309,
      -0.057594201, 0.081349374, 0.009249779, 0.003574267, 0.035124349,
      0.032823368, -0.000983764, -0.020131699, -0.048168865, 0.032042619,
      0.02215033, 0.009306706, 0.010632958, -0.012545565, 0.014755575,
      -0.004602949, 0.069947933, 0.03125303, 0.016112177, -0.002837338,
      0.026172439, -0.034384998, 0.046214275, -0.032926917, 0.006124195,
      0.047693553, 0.001623643, 0.005969101, -0.037761546, 0.040220229,
      0.009456267, 0.007121513, 0.022193624, 0.006020723, -0.003048291,
      0.037097937, -0.011418524, 0.012395477, 0.033201405, -0.012725834,
      0.019449875, 0.02180023, 0.017129659, -0.007099941, 0.001455313,
      -0.057920957, 0.008197818, -0.048363043, -0.022321408, 0.060459705,
      0.016298927, -0.002209136, -0.02043579, 0.025841129, 0.032462081,
      -0.005623438, 0.011236643, 0.095741774, 0.044720907, 0.003960038,
      0.021186945, 0.02952253, -0.02387992, 0.031377959, 0.000811964, 0.043261407,
      0.005730499, -0.018808918, 0.028806599, -0.011283685, 0.007943946,
      0.030934213, -0.014710317, 0.028668999, -0.003767265, 0.012709765,
      -0.005504011, -0.017344616, -0.031027216, 0.029853542, 0.048352794,
      0.002049414, 0.034096554, 0.021196799, 0.003697976, -0.057229621,
      0.009749339, -0.067599699, 0.036174013, 0.021613063, 0.038419122,
      0.016389135, -0.034987057, 0.066877446, 0.039069597, -0.024050734,
      0.016559128, -0.026576213, 0.028250656, 0.016442843, -0.013348679,
      -0.054441219, -0.077107121, 0.088711775, 0.066914215, 0.025731523,
      -0.002163719, 0.051438001, 0.005092577, -0.043904319, 0.074960267,
      0.024530444, 0.00035276, -0.009964653, 0.039063616, 0.032057767,
      -0.012910966, 0.047861481, 0.012803278, 0.032103961, -0.022690349,
      0.037982697, 0.020707931, 0.024200874, -0.046887045, -0.020812542,
      0.048808033, -0.027927824, -0.003011819, -0.062424968, 0.071459876,
      0.000865534, -0.048166599, 0.030908598, 0.030595049, -0.055429067,
      0.041454797, -0.006053093, 0.0330938, -0.002472878, 0.016371523,
      0.030941385, 0.017910969, -0.00752005, -0.001675404, -0.031410196,
    ],
    gold: [
      0.030759569, -0.024410066, -0.064255422, 0.006630831, -0.06910809,
      0.013645572, 0.022467304, 0.078568585, 0.007551103, 0.126954805,
      -0.05433357, -0.003370832, 0.082310397, 0.00087846, 0.051914904,
      0.082439843, -0.007258439, -0.093143721, 0.07699149, 0.025583486,
      0.016868587, 0.049682789, 0.021494308, -0.085614602, 0.04307311,
      0.026781968, 0.048665584, -0.00469299, 0.002056547, 0.058874644,
      0.130958993, -0.071128119, 0.021609449, 0.043320647, -0.094182642,
      0.095081142, -0.035342747, -0.021560026, -0.016477926, -0.013134186,
      0.005166772, 0.0107911, 0.03470205, 0.027282045, -0.026576198, 0.003612545,
      -0.037875485, 0.017504835, -0.006911593, 0.007176196, -0.094032321,
      -0.040513812, -0.110544082, 0.07161508, 0.034036976, -0.088497827,
      0.005661105, -0.072280746, -0.04860542, 0.03872985, 0.045748071,
      -0.027212599, -0.006787602, -0.024676663, 0.038466818, -0.021635374,
      0.02061982, -0.038577122, -0.015880419, 0.015734095, 0.018309707,
      0.118721396, -0.07682878, 0.015720486, -0.034183753, 0.008496081,
      -0.040913638, -0.060360088, 0.053286253, -0.003607943, 0.004135061,
      -0.045083356, 0.017858364, 0.088620493, 0.13199777, -0.035453013,
      0.030943988, -0.052026855, 0.181679402, 0.027294402, -0.024802708,
      0.01757756, 0.028155052, -0.100516551, -0.005090515, 0.03040996,
      0.046923081, -0.013338413, -0.01645894, 0.004396995, -0.031604498,
      0.007487257, 0.063157268, -0.065655227, 0.001925692, -0.015782386,
      0.022385309, -0.017129074, 0.009996128, -0.013740457, 0.010394216,
      0.021375743, -2.87e-2, -0.017089885, -0.006548572, -0.012901279,
      0.039017533, 0.006996544, 0.048403641, 0.002108534, -0.018281144,
      0.001132159, -0.006960311, 0.0483694, 0.073148469, 0.046497682, 0.074130979,
      -0.04179878, -0.024080898, -0.032116651, 0.010272719, 0.051822576,
      0.025608245, 0.033169604, 0.042080292, 0.038111085, 0.02131723, 0.045841846,
      -0.022999863, -0.004542582, -0.012210447, -0.08357763, 0.04011389,
      -0.023611381, -0.085739268, -0.003573148, 0.034120055, 0.042841976,
      -0.04355981, 0.026188802, 0.000672312, 0.000967822, -0.011751652,
      0.029758479, 0.002650635, -0.006327396, 0.060839565, 0.04117466,
      0.023701674, -0.038355135, 0.01767156, -0.023993605, 0.020225332,
      0.014763972, -0.049516777, 0.026680668, 0.023922521, 0.038832282,
      -0.035085939, 0.059760613, -0.012836179, 0.002725186, -0.050229425,
      0.015152685, 0.000565306, -0.00984828, 0.077113141,
    ],
  };
  
  const portfolioDescriptions = {
    veryCons:
      "Designed for investors who are likely to need their money in the next 0-2 years, or are retired. If you are primarily looking for capital protection in the long-term with limited volatility, this portfolio might be right for you.",
    conservative:
      "Designed for investors who are likely to need their money in the next 2-4 years. If you are looking for a portfolio that anticipates limited capital fluctuation but a steady return, this portfolio might be right for you.",
    moderate:
      "Designed for investors who are likely to need their money in the next 4-6 years. If you are looking for moderate capital appreciation with a lower level of risk than other aggressive portfolios, this one might be right for you. ",
    modAgg:
      "Designed for investors who may need their money in 6-8 years. If you are looking for steady long-term growth with a little volatility, this portfolio might be right for you.",
    aggressive:
      "Designed for investors who don’t plan to withdraw for 8-10 years. This portfolio might be suitable for you if you are looking for long term capital appreciation, and are comfortable with some volatility. ",
    veryAgg:
      "Designed for investors who don’t plan to withdraw for 10+ years If you’re looking for strong long-term returns and are comfortable with short-term volatility, this portfolio might be right for you.",
    gold: "Description for Gold",
  };
  
  document.addEventListener("DOMContentLoaded", function () {
    const inputField = document.getElementById("initialHistoricalDeposit");
    inputField.value = "1000";
  
    inputField.addEventListener("input", function () {
      this.value = this.value.replace(/[^0-9]/g, "");
    });
  
    // Clear input field when it receives focus
    inputField.addEventListener("focus", function () {
      this.value = "";
    });
  
    const radioButtons = document.getElementsByName("returns-radio-portfolio");
    const chartCanvas = document
      .getElementById("returnChartHistorical")
      .getContext("2d");
    let chart; // Chart instance
    const periodRadioButtons = document.getElementsByName("periodType");
    const selectField = document.getElementById("selectField");
  
    // Preselect 'modAgg' option in the selectField
    if (window.getComputedStyle(selectField).display !== "none") {
      selectField.value = "moderate"; // Replace 'modAgg' with the actual value attribute of the option you want to preselect
      updatePortfolioText(selectField.value); // Update the portfolio text based on the preselected option
      updateChart(); // Call updateChart to reflect changes based on the preselected option
    }
  
    function updatePortfolioText(portfolioType) {
      const description = portfolioDescriptions[portfolioType];
      if (description) {
        document
          .querySelectorAll(".return-text-for-portfolio")
          .forEach((element) => {
            element.textContent = description;
          });
      }
    }
  
    function getPeriodLength() {
      let periodLength;
      periodRadioButtons.forEach((radioButton) => {
        if (radioButton.checked) {
          switch (radioButton.value) {
            case "1Y":
              periodLength = 12;
              break;
            case "3Y":
              periodLength = 36;
              break;
            case "5Y":
              periodLength = 60;
              break;
            case "10Y":
              periodLength = 120;
              break;
            default:
              periodLength = 12;
          }
        }
      });
      return periodLength;
    }
  
    function getSelectedPortfolioType() {
      // Check if selectField is visible (mobile)
      if (window.getComputedStyle(selectField).display !== "none") {
        return selectField.value;
      }
  
      // Else, use radio buttons (desktop)
      let selectedValue = null;
      radioButtons.forEach((radioButton) => {
        if (radioButton.checked) {
          selectedValue = radioButton.value;
        }
      });
      return selectedValue;
    }
  
    function calculateTotalReturn() {
      const initialInvestment = parseFloat(inputField.value) || 0;
      let totalReturn = initialInvestment;
      let monthlyReturnsAccumulated = [initialInvestment]; // Include initial investment as the first data point
      let periodLength = getPeriodLength();
  
      const portfolioType = getSelectedPortfolioType(); // Get portfolio type
  
      if (portfolioType) {
        let monthlyReturns = returnData[portfolioType];
        monthlyReturns = monthlyReturns.slice(-periodLength);
  
        monthlyReturns.forEach((monthlyReturn) => {
          totalReturn += totalReturn * monthlyReturn;
          monthlyReturnsAccumulated.push(totalReturn);
        });
      }
  
      return monthlyReturnsAccumulated; // Now includes initial amount as first data point
    }
  
    function getMonthYearLabels(numMonths) {
      const labels = [];
      const currentDate = new Date();
  
      // Add label for the start (far left)
      labels.push(`Month Year Start`);
  
      for (let i = 0; i < numMonths; i++) {
        // Subtract months from the current date
        currentDate.setMonth(currentDate.getMonth() - 1);
  
        // Format the date as "Month YYYY"
        const monthName = currentDate.toLocaleString("default", {
          month: "long",
        });
        const year = currentDate.getFullYear();
  
        labels.push(`${monthName} ${year}`);
      }
  
      // Add label for the end (far right)
      labels.push(`Month Year End`);
  
      return labels;
    }
  
    function getAbbreviatedMonthYearLabels(numTicks) {
      const labels = [];
      const currentDate = new Date();
  
      for (let i = numTicks - 1; i >= 0; i--) {
        const date = new Date(
          currentDate.getFullYear(),
          currentDate.getMonth() - i - 1,
          1,
        );
        const monthName = date.toLocaleString("default", { month: "short" });
        const year = date.getFullYear();
  
        labels.push(`${monthName} ${year}`);
      }
  
      return labels;
    }
  
    function updateEndingBalance() {
      const monthlyReturnsAccumulated = calculateTotalReturn();
      const endingBalance =
        monthlyReturnsAccumulated[monthlyReturnsAccumulated.length - 2];
  
      // Format the ending balance with thousand separators
      const formattedEndingBalance = new Intl.NumberFormat("en-GB", {
        style: "decimal",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }).format(endingBalance);
  
      document.getElementById(
        "ending-balance",
      ).textContent = `£${formattedEndingBalance}`;
    }
  
    function updateTotalReturns() {
      const initialInvestment = parseFloat(inputField.value) || 0;
      const monthlyReturnsAccumulated = calculateTotalReturn();
      const endingBalance =
        monthlyReturnsAccumulated[monthlyReturnsAccumulated.length - 2];
      const totalReturnsPercentage =
      ((endingBalance - initialInvestment) / initialInvestment) * 100;
      document.getElementById(
        "total-returns",
      ).textContent = `${totalReturnsPercentage.toFixed(2)}%`;
    }
  
    function updateChart() {
      const monthlyReturnsAccumulated = calculateTotalReturn();
      const periodLength = getPeriodLength(); // Get the dynamic period length
      const monthYearLabels = getAbbreviatedMonthYearLabels(periodLength); // Generate labels based on period length
      // Generate labels based on the length of monthlyReturnsAccumulated
      const labels = Array.from(
        { length: monthlyReturnsAccumulated.length },
        (_, i) => `Month ${i + 1}`,
      );
  
      // Create gradient
      let gradient = chartCanvas.createLinearGradient(
        0,
        0,
        0,
        chartCanvas.canvas.clientHeight,
      );
      gradient.addColorStop(0, "#E4BA9E"); // Top color
      gradient.addColorStop(1, "rgba(255, 255, 255, 0)"); // Transparent at the bottom
  
      if (!chart) {
        chart = new Chart(chartCanvas, {
          type: "line",
          data: {
            labels: monthYearLabels,
            datasets: [
              {
                label: "£",
                tension: 0.4,
                data: monthlyReturnsAccumulated,
                borderColor: "#e4ba9e",
                fill: "origin",
                displayColors: false,
                backgroundColor: gradient,
                pointRadius: 1, // Increase the point radius
                pointStyle: "rectRounded", // Use a transparent circle as the point style
                radius: 20, // Set the radius to 0 to hide the points on the line
              },
            ],
          },
          options: {
            interaction: {
              intersect: false,
              mode: "index",
            },
            tooltips: {
              enable: false,
              mode: "index",
              intersect: false,
            },
  
            responsive: true, // Make chart responsive
            maintainAspectRatio: false, // Allow chart to resize in height
            scales: {
              y: {
                beginAtZero: false,
                ticks: {
                  callback: function (value, index, values) {
                    return value >= 1000 ? "£" + value / 1000 + "K" : "£" + value; // Format as 'K' for thousands
                  },
                },
              },
              x: {
                ticks: {
                  display: false,
                  autoSkip: true,
                  // Ensure the tick label uses the corresponding label from the array
                  callback: function (value, index, values) {
                    if (index === 0 || index === values.length - 1) {
                      // Display labels for the first and last ticks
                      return monthYearLabels[index];
                    } else {
                      // Return an empty string for other ticks
                      return "";
                    }
                  },
                },
                grid: {
                  display: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false, // Remove legend
              },
              tooltip: {
                enabled: false,
                external: function (context) {
                  // Getting the tooltip element
                  var tooltipEl = document.getElementById("external-tooltip");
                  var tooltipAmount = document.getElementById("tooltip-amount");
                  var tooltipDate = document.getElementById("tooltip-date");
  
                  // Hide if no tooltip
                  if (context.tooltip.opacity === 0) {
                    tooltipEl.style.opacity = 0;
                    tooltipEl.style.visibility = "hidden";
                    return;
                  }
  
                  // Get the first data point
                  var tooltipData = context.tooltip.dataPoints[0];
  
                  // Format the amount
                  var amount = tooltipData.raw;
                  var formattedAmount = new Intl.NumberFormat("en-GB", {
                    style: "decimal",
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                  }).format(amount);
  
                  tooltipAmount.innerHTML = `£${formattedAmount}`;
                  tooltipDate.innerHTML = tooltipData.label;
  
                  // Check if on a mobile device (by window width)
                  var isMobile = window.innerWidth <= 768; // Adjust 768 as needed for your mobile breakpoint
  
                  // Positioning
                  var position = context.chart.canvas.getBoundingClientRect();
                  var tooltipWidth = tooltipEl.offsetWidth;
                  var tooltipHeight = tooltipEl.offsetHeight;
                  var canvasWidth = context.chart.canvas.width;
                  var canvasHeight = context.chart.canvas.height;
  
                  var leftPosition =
                    position.left +
                    window.pageXOffset +
                    tooltipData.element.x -
                    tooltipWidth / 2;
                  var topPosition =
                    position.top +
                    window.pageYOffset +
                    tooltipData.element.y -
                    tooltipHeight;
  
                  // Adjust for right edge of the canvas
                  if (leftPosition + tooltipWidth > position.left + canvasWidth) {
                    leftPosition =
                      position.left +
                      canvasWidth -
                      tooltipWidth -
                      (isMobile ? 100 : 8);
                  }
  
                  // Adjust if tooltip is too close to the left edge of the canvas
                  if (leftPosition < position.left + 36) {
                    leftPosition = position.left + 36; // 16px from the left edge
                  }
  
                  tooltipEl.style.opacity = 1;
                  tooltipEl.style.visibility = "visible";
                  tooltipEl.style.position = "absolute";
                  tooltipEl.style.left = leftPosition + "px";
                  tooltipEl.style.top = topPosition + "px";
                },
              },
            },
            layout: {
              padding: false,
            },
          },
        });
      } else {
        chart.data.labels = monthYearLabels;
        chart.data.datasets[0].data = monthlyReturnsAccumulated;
        chart.data.datasets[0].backgroundColor = gradient;
        chart.update();
      }
      // Call the functions to update ending balance and total returns
      updateEndingBalance(); // If you have implemented this
      updateTotalReturns(); // Update total returns
    }
  
    periodRadioButtons.forEach((radioButton) => {
      radioButton.addEventListener("change", updateChart);
    });
  
    inputField.addEventListener("input", updateChart);
    radioButtons.forEach((radioButton) => {
      radioButton.addEventListener("change", updateChart);
    });
    selectField.addEventListener("change", updateChart);
  
    selectField.addEventListener("change", function () {
      updateChart();
      updatePortfolioText(this.value); // Update text when portfolio changes
    });
  
    radioButtons.forEach((radioButton) => {
      radioButton.addEventListener("change", function () {
        updateChart();
        updatePortfolioText(this.value); // Update text when portfolio changes
      });
    });
  
    // Initialize the chart with default values
    updateChart();
    updatePortfolioText(getSelectedPortfolioType());
  });
  
  document.addEventListener("DOMContentLoaded", function () {
    var form = document.getElementById("email-form"); // Replace with your form's ID
  
    form.addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        // Optional: Add any additional actions you want to happen when Enter is pressed
        return false;
      }
    });
  });
  